---
title: "誤ったGitアカウントでコミット・プッシュした場合の対処法"
emoji: "🔖"
type: "tech"
topics:
  - "git"
published: true
published_at: "2024-02-19 00:58"
---

## はじめに
初めまして、[やすのり](https://twitter.com/Bjp78xoSUd89227)です。

この記事では、諸事情[^1]により複数の`Github`アカウントを使用しているが、コミット・プッシュするユーザーを間違えてしまった場合の対処法について備忘録も兼ねて、お伝えしていきたいと思います。
※自分が執筆した記事なら振り返りやすいですしね笑
[^1]: 仕事とプライベート用のアカウントを使い分ける必要ができた etc...

## 発生事象の状況
- gitで作業中、誤ったアカウントの情報[^2]でコミットしてしまった。
    - 更にそのコミットをリモートリポジトリにプッシュしてしまった。
[^2]: `user.name`と`user.email`

## あるべき姿
- 正しいアカウント情報でのコミットがリモートリポジトリに反映している。

## 対応方針
1. ローカル環境にて、該当コミットのアカウント情報を修正。
2. リモートリポジトリに反映させるために強制プッシュ(`force push`)。
:::message alert
※複数人で作業しているブランチであれば、細心の注意が必要。
:::

## 対応方法
### 1. ローカル環境にて、該当コミットのアカウント情報を修正。
まずローカル環境で誤ったアカウントで実行したコミットのアカウント情報を修正しましょう。

#### 1-1 正しいアカウント情報になっているか確認もしくは変更
そもそも現状が正しいアカウントに切り替わっているのか確認します。

```shell
git config user.name
git config user.name
```

上記コマンドで現在のアカウント設定を確認し合っていれば[1-2](#1-2-%E4%BF%AE%E6%AD%A3%E5%AF%BE%E8%B1%A1%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%AE%E7%A2%BA%E8%AA%8D)へ、誤っていればこのまま下記手順で正しい情報に設定し直しておきましょう。

```shell
git config user.name "Correct Name"
git config user.email "correct@name.com"
```

これで設定完了です！

#### 1-2 修正対象コミットの確認
次に、誤ったアカウント情報で作成したコミットを確認していきます。
下記コミットログ確認用コマンドで`Author`部分が誤ったアカウント情報になっているコミットを探します。

```shell
git log
```

コミットを見つけたら、`コミットのハッシュ値`もしくは`最新コミットから何番目か`をメモしておきましょう！

#### 1-3 修正対象コミットを実際に修正
それでは最後にコミットを修正していきましょう。
先ほど確認したコミットが修正範囲に入るように、下記コマンドを実行しましょう。

```shell
# HEAD(最新コミット)から3つ前のコミットまで遡る
git rebase -i HEAD~3

# もしくはハッシュ値で指定
git rebase -i <hash-of-commit>
```

すると下記のようなエディタが開くので、修正したいコミットの`pick`部分を`edit`に変更しエディタを閉じてください。

```shell
pick cffe0df 最新
pick 1e51we4 最新から２つ目
pick 2cb2342 最新から3つ目

# Rebase 2eb177e..2cbec48 onto 2eb177e (3 commands)
#
# Commands:
# ......
```

今回はコミットメッセージ等ではなく、アカウントの情報変更だけなので、下記コマンドを実行しましょう。

```shell
git rebase --continue
```

これだけで基本は完了です！
もし修正対象のコミットが複数あるなら、上記の作業を繰り返しましょう。

### 2. リモートリポジトリに反映させるために強制プッシュ(`force push`)。
ローカル環境で修正したコミットの内容をリモートリポジトリに反映させます。

:::message alert
※複数人で作業しているブランチであれば、現状のリモートリポジトリの状態を上書きしてしまうので、メンバーの許可が必ず得てから実行しましょう。
:::

```shell
git push --force
```

上記コマンドを実行後、リモートリポジトリにアカウント情報が正しく反映されていれば終了です！

# 再発防止
これで修正方法はわかりましたが、極力この事象自体を起こさないようにしておきたいです。

なので私は[こちら](https://zenn.dev/taichifukumoto/articles/how-to-use-multiple-github-accounts#%E3%80%90tips%E3%80%91%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E4%B8%8A%E3%81%A7%E3%81%A9%E3%81%A1%E3%82%89%E3%81%AE-github-%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B)の記事を参考に、ターミナル上でアカウント名が常に表示されるようにしておきました。

この記事が誰かのお役に立てば嬉しいです！